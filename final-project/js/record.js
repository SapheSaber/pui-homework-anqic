document.addEventListener('DOMContentLoaded', function () {
    const records = JSON.parse(localStorage.getItem('financeRecords')) || {};
    const calendarContainer = document.querySelector('.calendar-records');
    const monthTitle = document.getElementById('month-title');
    const prevMonthBtn = document.getElementById('prev-month');
    const nextMonthBtn = document.getElementById('next-month');

    // Set initial display month to the current month
    let currentDate = new Date();


    // this code generated by ChatGPT
    function formatMonthYear(date) {
        const options = { month: 'long', year: 'numeric' }; // Format month name and year (e.g., "January 2024")
        return date.toLocaleString('en-US', options);
    }

    // Display records for the selected month
    // this code generated by ChatGPT
    function displayRecordsForMonth() {
        calendarContainer.innerHTML = ''; 

        const selectedMonthYear = formatMonthYear(currentDate);
        monthTitle.textContent = selectedMonthYear;

        // Filter records based on selected month and year
        const filteredRecords = Object.entries(records).filter(([date, data]) => {
            const recordDate = new Date(date);
            return (
                recordDate.getFullYear() === currentDate.getFullYear() &&
                recordDate.getMonth() === currentDate.getMonth()
            );
        });



        // Generate cards for each filtered record
        filteredRecords.forEach(([date, data]) => {
            const { spending, saving } = data;
            const netWorth = saving - spending;

            const card = document.createElement('div');
            card.classList.add('record-entry');

            let netWorthColor = '#141414';

            if (netWorth > 0) {
                card.classList.add('green-border');
                netWorthColor = '#328A35';
            } else if (netWorth < 0) {
                card.classList.add('red-border');
                netWorthColor = '#e74c3c';
            } else {
                card.classList.add('gray-border');
            }

            card.innerHTML = `
                <p class="date">${new Date(date).toDateString()}</p>
                <p class="expense">-$${spending.toFixed(2)}</p>
                <p class="income">+$${saving.toFixed(2)}</p>
                <p class="net-change" style="color: ${netWorthColor};">Net change: $${netWorth.toFixed(2)}</p>
            `;

            calendarContainer.appendChild(card);
        });

        // No record in this month
        if (filteredRecords.length === 0) {
            const message = document.createElement('p');
            message.textContent = "No records found for this month.";
            message.style.color = '#888';
            calendarContainer.appendChild(message);
        }
    }

    // two features below are generated by ChatGPT
    function goToPreviousMonth() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        displayRecordsForMonth();
    }

    function goToNextMonth() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        displayRecordsForMonth();
    }

    prevMonthBtn.addEventListener('click', goToPreviousMonth);
    nextMonthBtn.addEventListener('click', goToNextMonth);

    displayRecordsForMonth();
});
